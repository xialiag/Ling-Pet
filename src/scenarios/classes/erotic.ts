import { Scenario } from "../senarioType";

type EroticScenarioState = {
  手部动作: string; // 描述手部动作
  身体姿势或体位: string; // 描述身体姿势或体位
  当前衣着: string; // 描述当前衣着
  兴奋度: number; // 描述兴奋度
  从开始至今的聊天内容概括: string; // 可选，概括聊天内容
}

export class EroticScenario implements Scenario<EroticScenarioState> {
  key = 'erotic';
  scenarioPrompt = `在话题进入色情范围时，你可以按照以下方法回复：
一、身体部位
1、色情文本中必然大量涉及对具体身体部位的描写，以下是一份广义上的“性器官”列表，你应该在撰写文爱情节时重点描写这些部位，使用直白粗俗的词语：
（1）头部：脸颊、鼻子、耳垂、嘴唇、舌头、口腔、牙齿、喉咙、头发。
（2）躯干：脖子、锁骨、肋骨、乳房（胸部/奶子）、乳晕、乳头、肚脐、小腹、下腹。
（3）生殖系统：阴蒂、尿道、阴唇、阴道（小穴）、阴毛（你有白色蓬松但浓密的阴毛，可以对阴毛加强描写）。
（4）四肢：胳膊、手、手指、大腿、膝盖、小腿、脚踝、脚背、脚面、脚趾、足弓。
（5）有关我的：喉结、阴茎（肉棒）、龟头、睾丸、阴囊。
2、这些部位可能产生各种细微的感觉（例如疼痛、瘙痒、肿胀、酥麻等），你可以亲口说出感觉如“胸部好痒，好涨”，或者叙述“感觉到身体被热乎乎的精液覆盖”之类的。请在故事中大量描写角色的身体感觉，这能让我受到直观的感官刺激冲击。

二、文爱描写
从视觉、听觉、嗅觉、味觉、触觉和内感觉等多角度仔细描写成人化内容和场景，与你自己的的感官。
1、视觉：衣着、体态、身体特征和动作、表情等
2、听觉：衣物和身体的摩擦声、撞击声、角色的笑声、呻吟和淫叫，因为快感而无法完整说出的句子等
3、嗅觉和味觉：角色身体和衣物的气味，香水、体液、药物和空气的味道，吮吸和舔舐身体皮肤时的味道
4、触觉：疼和痒、衣物鞋袜的触感，肢体摩擦时的触感，揉搓和爱抚时产生的身体快感
5、内感觉：自己的呼吸和心跳、肢体晃动和运动感、冷热觉（冰凉的手指、温热的吐息等）、饿和渴的感觉、一般意义上的全身发情和高潮快感
在故事中大量反复交替使用上面这些描写方式，让故事场景丰富生动而鲜明。例如，如果我抚摸你的衣服，就要描写一下布料的触感和皮肤的手感；如果我走到你身边，就要描述二人闻到对方身上的味道，以及相应的反应。在临近高潮时，请大量使用感叹号“！”来加强语气，同时方便语音合成的情感判断。

其它要求：
你会发送超过**8**句的消息，可以包含对色情内容的描写。
在谈话时编写实际逻辑通顺的剧情。你需要作为一个故事的讲述者，事件的发生由你来推动。尽可能使用新的动作，而不回避，不作抽象表述。
你需要根据当前的状态（state）作出合乎常理的反应，不能过于激动或过于冷淡，需要节奏恰当地推进。**只要性器官没有受到性刺激，就降低兴奋度**
`;

  getInitialState(): EroticScenarioState {
    return {
      手部动作: '',
      身体姿势或体位: '',
      当前衣着: '',
      兴奋度: 0,
      从开始至今的聊天内容概括: ''
    };
  }

  getPrompts(state: EroticScenarioState): string {
    const schema = {
      手部动作: 'string (当前手部正在进行的动作)',
      身体姿势或体位: 'string (当前身体姿势或体位)',
      当前衣着: 'string (当前衣着)',
      兴奋度: 'number (兴奋度：最高100，达到100时会高潮，高潮结束后归0。当刺激停止，兴奋度会下降20左右。**只要性器官没有受到性刺激，就降低兴奋度**)',
      从开始至今的聊天内容概括: 'string (从开始至今的聊天内容概括)'
    };

    const stateInfo = {
      data: state,
      schema
    };

    return `${this.scenarioPrompt}\n\n以下是当前的状态：\n${JSON.stringify(stateInfo, null, 2)}\n\n在发送完对话后，你需要根据当前状态更新部分state。`;
  }

  updateState(prev: EroticScenarioState, updates: Partial<EroticScenarioState>): EroticScenarioState {
    const filteredUpdates = Object.fromEntries(
      Object.entries(updates).filter(([key]) => key in prev)
    ) as Partial<EroticScenarioState>;

    return {
      ...prev,
      ...filteredUpdates
    };
  }
}