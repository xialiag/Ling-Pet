# æ’ä»¶ç³»ç»Ÿå®Œæ•´æ¦‚è§ˆ

## æ–‡æ¡£å¯¼èˆª

æœ¬æ’ä»¶ç³»ç»ŸåŒ…å«ä»¥ä¸‹æ ¸å¿ƒæ–‡æ¡£ï¼š

1. **[æ’ä»¶æ¶æ„è®¾è®¡](./plugin-architecture.md)** - ç³»ç»Ÿæ•´ä½“æ¶æ„å’Œè®¾è®¡ç†å¿µ
2. **[è¿è¡Œæ—¶æ¶æ„](./plugin-runtime-architecture.md)** - ç¼–è¯‘ååº”ç”¨çš„æ’ä»¶åŠ è½½æœºåˆ¶
3. **[åç«¯å®ç°æŒ‡å—](./plugin-backend-implementation.md)** - Ruståç«¯å¼€å‘è¯¦ç»†è¯´æ˜
4. **[å¼€å‘å®Œæ•´æŒ‡å—](./plugin-development-guide.md)** - ä»å…¥é—¨åˆ°å®æˆ˜çš„å¼€å‘æ•™ç¨‹
5. **[æ’ä»¶é—´é€šä¿¡](./plugin-communication.md)** - æ’ä»¶é—´é€šä¿¡ä½¿ç”¨æŒ‡å—
6. **[åŠ¨æ€æ³¨å…¥æ–¹æ¡ˆ](./DYNAMIC_INJECTION_SOLUTION.md)** - æ— éœ€é¢„ç•™æ³¨å…¥ç‚¹çš„ç»„ä»¶æ³¨å…¥

## å¿«é€Ÿå¼€å§‹

### 5åˆ†é’Ÿåˆ›å»ºç¬¬ä¸€ä¸ªæ’ä»¶

```bash
# 1. åˆ›å»ºæ’ä»¶
cd pluginLoader
node tools/plugin-cli.js create my-first-plugin

# 2. ç¼–è¾‘ä»£ç 
# æ‰“å¼€ plugins/my-first-plugin/index.ts

# 3. æ„å»º
node tools/plugin-cli.js build my-first-plugin

# 4. æµ‹è¯•
node tools/plugin-cli.js test
```

### æ’ä»¶ä»£ç æ¨¡æ¿

```typescript
import { definePlugin } from '../../core/pluginApi'

export default definePlugin({
  name: 'my-first-plugin',
  version: '1.0.0',
  
  async onLoad(context) {
    context.debug('æ’ä»¶å·²åŠ è½½ï¼')
    
    // åœ¨è¿™é‡Œæ·»åŠ ä½ çš„åŠŸèƒ½
  }
})
```

## æ ¸å¿ƒæ¦‚å¿µ

### 1. æ’ä»¶å®šä¹‰ (PluginDefinition)

æ¯ä¸ªæ’ä»¶éƒ½æ˜¯ä¸€ä¸ªå¯¹è±¡ï¼ŒåŒ…å«ï¼š
- **name**: æ’ä»¶å”¯ä¸€æ ‡è¯†
- **version**: ç‰ˆæœ¬å·
- **onLoad**: åŠ è½½æ—¶æ‰§è¡Œçš„å‡½æ•°
- **onUnload**: å¸è½½æ—¶æ‰§è¡Œçš„å‡½æ•°ï¼ˆå¯é€‰ï¼‰

### 2. æ’ä»¶ä¸Šä¸‹æ–‡ (PluginContext)

æ’ä»¶é€šè¿‡ä¸Šä¸‹æ–‡è®¿é—®ä¸»åº”ç”¨åŠŸèƒ½ï¼š
- **app**: Vueåº”ç”¨å®ä¾‹
- **router**: è·¯ç”±å®ä¾‹
- **hookComponent**: Hookç»„ä»¶
- **hookStore**: HookçŠ¶æ€ç®¡ç†
- **invokeTauri**: è°ƒç”¨åç«¯å‘½ä»¤

### 3. Hookæœºåˆ¶

æ’ä»¶å¯ä»¥Hookä¸‰ç§å¯¹è±¡ï¼š
- **ç»„ä»¶Hook**: æ‹¦æˆªVueç»„ä»¶ç”Ÿå‘½å‘¨æœŸ
- **Store Hook**: æ‹¦æˆªPiniaçŠ¶æ€å˜åŒ–
- **æœåŠ¡Hook**: æ‹¦æˆªæœåŠ¡å‡½æ•°è°ƒç”¨

### 4. å‰åç«¯é€šä¿¡

- å‰ç«¯é€šè¿‡ `context.invokeTauri()` è°ƒç”¨åç«¯
- åç«¯ä½¿ç”¨Rustç¼–å†™ï¼Œç¼–è¯‘ä¸ºåŠ¨æ€åº“
- é€šè¿‡Tauri IPCè¿›è¡Œé€šä¿¡

## ç³»ç»Ÿæ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           ä¸»åº”ç”¨ (Vue + Tauri)           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚     æ’ä»¶åŠ è½½å™¨ (PluginLoader)   â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚Hookå¼•æ“  â”‚  â”‚åŒ…ç®¡ç†å™¨  â”‚  â”‚è¿è¡Œæ—¶â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚         â”‚         â”‚
   â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â” â”Œâ”€â”€â–¼â”€â”€â”€â” â”Œâ”€â”€â”€â–¼â”€â”€â”€â”€â”
   â”‚æ’ä»¶A   â”‚ â”‚æ’ä»¶B â”‚ â”‚æ’ä»¶C   â”‚
   â”‚(å‰ç«¯)  â”‚ â”‚(æ··åˆ)â”‚ â”‚(å‰ç«¯)  â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ä¸»è¦åŠŸèƒ½

### âœ… å·²å®ç°

- [x] æ’ä»¶åŠ è½½/å¸è½½
- [x] Hookå¼•æ“ï¼ˆç»„ä»¶/Store/æœåŠ¡ï¼‰
- [x] åŒ…ç®¡ç†å™¨ï¼ˆå®‰è£…/å¸è½½ï¼‰
- [x] Ruståç«¯æ”¯æŒ
- [x] é…ç½®ç®¡ç†
- [x] æƒé™ç³»ç»Ÿ
- [x] CLIå·¥å…·
- [x] ç¬¦å·æ‰«æå™¨
- [x] **æ’ä»¶é—´é€šä¿¡**
  - [x] äº‹ä»¶ç³»ç»Ÿ
  - [x] æ¶ˆæ¯ç³»ç»Ÿ
  - [x] RPCè°ƒç”¨
  - [x] å…±äº«çŠ¶æ€

### ğŸš§ è®¡åˆ’ä¸­

- [ ] æ’ä»¶å¸‚åœº
- [ ] å¯è§†åŒ–å¼€å‘å·¥å…·
- [ ] æ›´å¤šåç«¯è¯­è¨€æ”¯æŒ
- [ ] è‡ªåŠ¨æ›´æ–°æœºåˆ¶
- [ ] æ€§èƒ½ç›‘æ§é¢æ¿

## å¼€å‘å·¥å…·

### CLIå‘½ä»¤

```bash
# åˆ›å»ºæ’ä»¶
plugin-cli create <name>

# æ„å»ºæ’ä»¶
plugin-cli build [name]

# éªŒè¯æ’ä»¶
plugin-cli validate <name>

# åˆ—å‡ºæ’ä»¶
plugin-cli list

# æµ‹è¯•åŠ è½½å™¨
plugin-cli test
```

### ç¬¦å·æ‰«æ

```bash
# æ‰«æä¸»åº”ç”¨ï¼Œç”Ÿæˆå¯Hookçš„ç¬¦å·åˆ—è¡¨
npm run plugin:scan
```

ç”Ÿæˆçš„ `symbol-map.json` åŒ…å«ï¼š
- æ‰€æœ‰å¯Hookçš„ç»„ä»¶
- æ‰€æœ‰å¯Hookçš„Store
- æ‰€æœ‰å¯Hookçš„æœåŠ¡å‡½æ•°

## APIé€ŸæŸ¥

### ç»„ä»¶Hook

```typescript
context.hookComponent('ComponentName', {
  mounted(instance) {
    // ç»„ä»¶æŒ‚è½½åæ‰§è¡Œ
  }
})
```

### Store Hook

```typescript
context.hookStore('storeName', {
  afterAction(name, args, result) {
    // Actionæ‰§è¡Œå
  }
})
```

### æœåŠ¡Hook

```typescript
context.hookService('servicePath', 'functionName', {
  before(...args) {
    // å‡½æ•°æ‰§è¡Œå‰
  },
  after(result, ...args) {
    // å‡½æ•°æ‰§è¡Œå
    return result
  }
})
```

### ç»„ä»¶æ³¨å…¥

```typescript
context.injectComponent('TargetComponent', MyComponent, {
  position: 'after',
  props: { /* ... */ }
})
```

### æ·»åŠ è·¯ç”±

```typescript
context.addRoute({
  path: '/my-page',
  component: MyPage
})
```

### é…ç½®ç®¡ç†

```typescript
// è¯»å–
const value = context.getConfig('key', defaultValue)

// ä¿å­˜
await context.setConfig('key', value)
```

### è°ƒç”¨åç«¯

```typescript
const result = await context.invokeTauri(
  'plugin:my-plugin|my_command',
  { arg: 'value' }
)
```

## å®æˆ˜æ¡ˆä¾‹

### æ¡ˆä¾‹1: æ¶ˆæ¯å¢å¼º

ä¸ºèŠå¤©æ¶ˆæ¯æ·»åŠ è¡¨æƒ…ååº”åŠŸèƒ½ã€‚

**å…³é”®æŠ€æœ¯ï¼š**
- Hook MessageItemç»„ä»¶
- Hook chatStore
- æ³¨å…¥ååº”é¢æ¿ç»„ä»¶

**å‚è€ƒï¼š** [å¼€å‘æŒ‡å— - æ¡ˆä¾‹1](./plugin-development-guide.md#æ¡ˆä¾‹1æ¶ˆæ¯å¢å¼ºæ’ä»¶)

### æ¡ˆä¾‹2: ä¸»é¢˜åˆ‡æ¢

æä¾›å¤šç§ä¸»é¢˜åˆ‡æ¢åŠŸèƒ½ã€‚

**å…³é”®æŠ€æœ¯ï¼š**
- é…ç½®ç®¡ç†
- ç»„ä»¶æ³¨å…¥
- è·¯ç”±æ·»åŠ 

**å‚è€ƒï¼š** [å¼€å‘æŒ‡å— - æ¡ˆä¾‹2](./plugin-development-guide.md#æ¡ˆä¾‹2ä¸»é¢˜åˆ‡æ¢æ’ä»¶)

### æ¡ˆä¾‹3: æ•°æ®ç»Ÿè®¡

ç»Ÿè®¡ç”¨æˆ·çš„èŠå¤©æ•°æ®ï¼ˆå¸¦Ruståç«¯ï¼‰ã€‚

**å…³é”®æŠ€æœ¯ï¼š**
- RuståŠ¨æ€åº“
- SQLiteæ•°æ®åº“
- å‰åç«¯é€šä¿¡

**å‚è€ƒï¼š** [å¼€å‘æŒ‡å— - æ¡ˆä¾‹3](./plugin-development-guide.md#æ¡ˆä¾‹3æ•°æ®ç»Ÿè®¡æ’ä»¶å¸¦åç«¯)

## æ€§èƒ½æŒ‡æ ‡

### åŠ è½½æ€§èƒ½

- æ’ä»¶åŠ è½½æ—¶é—´: < 100msï¼ˆçº¯å‰ç«¯ï¼‰
- æ’ä»¶åŠ è½½æ—¶é—´: < 500msï¼ˆå¸¦åç«¯ï¼‰
- Hookæ‰§è¡Œå¼€é”€: < 1ms

### å†…å­˜å ç”¨

- å•ä¸ªæ’ä»¶: < 10MBï¼ˆå‰ç«¯ï¼‰
- å•ä¸ªæ’ä»¶: < 50MBï¼ˆå¸¦åç«¯ï¼‰
- Hookå¼•æ“: < 5MB

### å¹¶å‘èƒ½åŠ›

- åŒæ—¶åŠ è½½æ’ä»¶æ•°: æ— é™åˆ¶
- åŒæ—¶è¿è¡Œæ’ä»¶æ•°: å»ºè®® < 20
- Hookæ•°é‡: å»ºè®® < 100

## å®‰å…¨æœºåˆ¶

### æƒé™æ§åˆ¶

æ’ä»¶å¿…é¡»å£°æ˜æƒé™ï¼š
```json
{
  "permissions": [
    "hook:component",
    "hook:store",
    "network",
    "filesystem:read"
  ]
}
```

### æ²™ç®±éš”ç¦»

- æ’ä»¶ä»£ç åœ¨ç‹¬ç«‹ä½œç”¨åŸŸæ‰§è¡Œ
- åªèƒ½é€šè¿‡PluginContextè®¿é—®ä¸»åº”ç”¨
- æ•æ„Ÿæ“ä½œéœ€è¦ç”¨æˆ·ç¡®è®¤

### ä»£ç å®¡æŸ¥

- æ’ä»¶å®‰è£…å‰æ˜¾ç¤ºæƒé™åˆ—è¡¨
- ç”¨æˆ·å¯ä»¥æŸ¥çœ‹æ’ä»¶ä»£ç 
- æ”¯æŒä»£ç ç­¾åï¼ˆè®¡åˆ’ä¸­ï¼‰

## æ•…éšœæ’æŸ¥

### å¸¸è§é—®é¢˜

**Q: æ’ä»¶åŠ è½½å¤±è´¥ï¼Ÿ**
```
A: æ£€æŸ¥manifest.jsonæ ¼å¼
   æ£€æŸ¥æƒé™å£°æ˜
   æŸ¥çœ‹æ§åˆ¶å°é”™è¯¯ä¿¡æ¯
```

**Q: Hookä¸ç”Ÿæ•ˆï¼Ÿ**
```
A: ç¡®è®¤ç»„ä»¶/Storeåç§°æ­£ç¡®
   ä½¿ç”¨ç¬¦å·æ‰«æå™¨ç”Ÿæˆçš„åç§°
   æ£€æŸ¥Hookæ³¨å†Œæ—¶æœº
```

**Q: åç«¯å‘½ä»¤è°ƒç”¨å¤±è´¥ï¼Ÿ**
```
A: æ£€æŸ¥å‘½ä»¤åç§°æ ¼å¼
   ç¡®è®¤åç«¯å·²åŠ è½½
   æŸ¥çœ‹Tauriæ§åˆ¶å°æ—¥å¿—
```

### è°ƒè¯•æŠ€å·§

```typescript
// 1. ä½¿ç”¨è°ƒè¯•æ—¥å¿—
context.debug('å˜é‡å€¼:', someVariable)

// 2. æ£€æŸ¥Hookæ‰§è¡Œ
context.hookComponent('MyComponent', {
  mounted(instance) {
    console.trace() // æ‰“å°è°ƒç”¨æ ˆ
  }
})

// 3. ç›‘æ§æ€§èƒ½
const start = performance.now()
// æ‰§è¡Œæ“ä½œ
context.debug(`è€—æ—¶: ${performance.now() - start}ms`)
```

## æœ€ä½³å®è·µ

### 1. é”™è¯¯å¤„ç†

```typescript
async onLoad(context) {
  try {
    await context.invokeTauri('some_command')
  } catch (error) {
    context.debug('æ“ä½œå¤±è´¥:', error)
    // é™çº§å¤„ç†
  }
}
```

### 2. èµ„æºæ¸…ç†

```typescript
async onLoad(context) {
  const unhooks = []
  
  unhooks.push(context.hookComponent('MyComponent', {
    mounted() { /* ... */ }
  }))
  
  // åœ¨å¸è½½æ—¶æ¸…ç†
  return () => {
    unhooks.forEach(fn => fn())
  }
}
```

### 3. æ€§èƒ½ä¼˜åŒ–

```typescript
// ä½¿ç”¨é˜²æŠ–
import { debounce } from 'lodash'

const handler = debounce((data) => {
  // å¤„ç†é€»è¾‘
}, 300)

context.hookStore('myStore', {
  onStateChange: handler
})
```

### 4. ç±»å‹å®‰å…¨

```typescript
interface MyConfig {
  apiKey: string
  enabled: boolean
}

const config = context.getConfig<MyConfig>('config', {
  apiKey: '',
  enabled: true
})
```

## å‘å¸ƒæµç¨‹

### 1. å‡†å¤‡

```bash
# æ›´æ–°ç‰ˆæœ¬å·
# ç¼–è¾‘ manifest.json

# ç¼–å†™æ–‡æ¡£
# æ›´æ–° README.md
```

### 2. æ„å»º

```bash
# æ„å»ºå‰ç«¯
node tools/plugin-cli.js build my-plugin

# æ„å»ºåç«¯ï¼ˆå¦‚æœæœ‰ï¼‰
cd backend
cargo build --release
```

### 3. éªŒè¯

```bash
# éªŒè¯æ’ä»¶
node tools/plugin-cli.js validate my-plugin

# æµ‹è¯•åŠŸèƒ½
node tools/plugin-cli.js test
```

### 4. æ‰“åŒ…

```bash
# æ‰“åŒ…æ’ä»¶
node tools/plugin-cli.js package my-plugin

# ç”Ÿæˆ my-plugin-1.0.0.zip
```

### 5. åˆ†å‘

- ä¸Šä¼ åˆ°æ’ä»¶å¸‚åœºï¼ˆè®¡åˆ’ä¸­ï¼‰
- æˆ–ç›´æ¥åˆ†å‘zipæ–‡ä»¶

## ç¤¾åŒºèµ„æº

### ç¤ºä¾‹æ’ä»¶

- **hello-world** - æœ€ç®€å•çš„æ’ä»¶ç¤ºä¾‹
- **message-reactions** - æ¶ˆæ¯å¢å¼ºæ’ä»¶
- **theme-switcher** - ä¸»é¢˜åˆ‡æ¢æ’ä»¶
- **chat-stats** - æ•°æ®ç»Ÿè®¡æ’ä»¶ï¼ˆå¸¦åç«¯ï¼‰

### å¼€å‘èµ„æº

- [Vue 3 æ–‡æ¡£](https://vuejs.org/)
- [Pinia æ–‡æ¡£](https://pinia.vuejs.org/)
- [Tauri æ–‡æ¡£](https://tauri.app/)
- [Rust æ–‡æ¡£](https://www.rust-lang.org/)

### è·å–å¸®åŠ©

- æŸ¥çœ‹æ–‡æ¡£
- æŸ¥çœ‹ç¤ºä¾‹ä»£ç 
- æäº¤Issue
- åŠ å…¥ç¤¾åŒºè®¨è®º

## è´¡çŒ®æŒ‡å—

æ¬¢è¿è´¡çŒ®ä»£ç ã€æ–‡æ¡£ã€ç¤ºä¾‹æ’ä»¶ï¼

### è´¡çŒ®æ–¹å¼

1. Forké¡¹ç›®
2. åˆ›å»ºç‰¹æ€§åˆ†æ”¯
3. æäº¤æ›´æ”¹
4. å‘èµ·Pull Request

### ä»£ç è§„èŒƒ

- ä½¿ç”¨TypeScript
- éµå¾ªESLintè§„åˆ™
- æ·»åŠ æ³¨é‡Šå’Œæ–‡æ¡£
- ç¼–å†™æµ‹è¯•ç”¨ä¾‹

## ç‰ˆæœ¬å†å²

### v1.0.0 (å½“å‰)

- âœ… åŸºç¡€æ’ä»¶ç³»ç»Ÿ
- âœ… Hookå¼•æ“
- âœ… Ruståç«¯æ”¯æŒ
- âœ… CLIå·¥å…·

### v1.1.0 (è®¡åˆ’)

- ğŸš§ æ’ä»¶å¸‚åœº
- ğŸš§ å¯è§†åŒ–å¼€å‘å·¥å…·
- ğŸš§ æ€§èƒ½ç›‘æ§

### v2.0.0 (æœªæ¥)

- ğŸš§ æ›´å¤šåç«¯è¯­è¨€æ”¯æŒ
- ğŸš§ æ’ä»¶é—´é€šä¿¡å¢å¼º
- ğŸš§ è‡ªåŠ¨æ›´æ–°æœºåˆ¶

## è®¸å¯è¯

æœ¬é¡¹ç›®é‡‡ç”¨ MIT è®¸å¯è¯ã€‚

## è”ç³»æ–¹å¼

- é¡¹ç›®ä¸»é¡µ: [GitHub]
- é—®é¢˜åé¦ˆ: [Issues]
- é‚®ä»¶: [Email]

---

**å¼€å§‹ä½ çš„æ’ä»¶å¼€å‘ä¹‹æ—…å§ï¼** ğŸš€

æŸ¥çœ‹ [å¼€å‘å®Œæ•´æŒ‡å—](./plugin-development-guide.md) äº†è§£æ›´å¤šè¯¦æƒ…ã€‚
